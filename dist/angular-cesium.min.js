angular.module("angularCesium",["observableCollection"]),angular.module("angularCesium").service("BillBoardAttributes",["$parse",function(e){this.calcAttributes=function(i,r){var o={image:e(i.image)(r)},n=e(i.position)(r);o.position=Cesium.Cartesian3.fromDegrees(Number(n.longitude)||0,Number(n.latitude)||0,Number(n.altitude)||0);var t=e(i.color)(r);return t&&(o.color=Cesium.Color.fromCssColorString(t)),o}}]),angular.module("angularCesium").factory("Cesium",function(){return Cesium}),angular.module("angularCesium").directive("acBillboard",["BillBoardAttributes",function(e){return{restrict:"E",require:"^acBillboardsLayer",link:function(i,r,o,n){var t=e.calcAttributes(o,i),l=n.getBillboardCollection().add(t);i.$on("$destroy",function(){n.getBillboardCollection().remove(l)})}}}]),angular.module("angularCesium").directive("acBaseLayerPicker",function(){return{restrict:"E",require:"^acMap",transclude:!0,template:'<div id="baseLayerPickerContainer" style="position:absolute;top:24px;right:24px;width:38px;height:38px;"><div ng-transclude></div></div>',controller:["$scope",function(e){function i(){return e.providerViewModels.terrainProviderViewModels}function r(){return e.providerViewModels.imageryProviderViewModels}function o(){return e.providerViewModels}function n(i,r){e.providerViewModels[i].push(r)}this.getProviderViewModels=o,this.pushProviderViewModel=n,this.getImageryViewModels=r,this.getTerrainViewModels=i}],link:{pre:function(e,i,r,o){e.providerViewModels={imageryProviderViewModels:[],terrainProviderViewModels:[]},e.baseLayerPicker=null,e.$on("$destroy",function(){o.getCesiumWidget().baseLayerPicker.destroy()})},post:function(e,i,r,o){e.$watch(function(){return e.providerViewModels},function(){e.baseLayerPicker?(e.baseLayerPicker.destroy(),e.baseLayerPicker=new Cesium.BaseLayerPicker("baseLayerPickerContainer",{globe:o.getCesiumWidget().scene.globe,imageryProviderViewModels:e.providerViewModels.imageryProviderViewModels,terrainProviderViewModels:e.providerViewModels.terrainProviderViewModels})):e.baseLayerPicker=new Cesium.BaseLayerPicker("baseLayerPickerContainer",{globe:o.getCesiumWidget().scene.globe,imageryProviderViewModels:e.providerViewModels.imageryProviderViewModels,terrainProviderViewModels:e.providerViewModels.terrainProviderViewModels})},!0)}}}}),angular.module("angularCesium").directive("acComplexLayer",["$log",function(e){return{restrict:"E",require:"^acMap",compile:function(i,r){r.observableCollection&&angular.forEach(i.children(),function(r){var o=void 0;"BILLBOARD"===r.tagName?o=angular.element("<billboards-layer></billboards-layer>"):"LABEL"===r.tagName&&(o=angular.element("<labels-layer></labels-layer>")),o?(angular.forEach(r.attributes,function(e){o.attr(e.name,e.value)}),angular.forEach(i[0].attributes,function(e){angular.element(r).attr(e.name)||o.attr(e.name,e.value)}),angular.element(r).replaceWith(o)):(e.warn("Found an unknown child of of complex-layer. Removing..."),angular.element(r).remove())})}}}]),angular.module("angularCesium").directive("acBillboardsLayer",["$parse","ObservableCollection","BillBoardAttributes","Cesium",function(e,i,r,o){return{restrict:"E",require:"^acMap",controller:["$scope","$attrs",function(e,i){function r(){if(i.observableCollection)throw new Error("cannot get collection if layer is bound to ObservableCollection");return e.collection}this.getBillboardCollection=r}],link:{pre:function(n,t,l,a){function c(e){var i={};i[g]=e;var o=r.calcAttributes(l,i);return n.collection.add(o)}function u(e,i){var r=n.collection.get(i);r.position=o.Cartesian3.fromDegrees(Number(e.position.longitude)||0,Number(e.position.latitude)||0,Number(e.position.altitude)||0),r.image=e.image,r.color=o.Color.fromCssColorString(e.color)}function s(e,i){n.collection.remove(n.collection.get(i))}if(n.collection=new o.BillboardCollection,l.observableCollection){var d=/\s*([\$\w]+)\s+in\s+((?:[\$\w]+\.)*[\$\w]+)/,m=l.observableCollection.match(d),g=m[1],v=e(m[2])(n);if(!v instanceof i)throw new Error("observable-collection must be of type ObservableCollection.");angular.forEach(v.getData(),function(e){c(e)}),v.onAdd(c),v.onUpdate(u),v.onRemove(s)}a.getCesiumWidget().scene.primitives.add(n.collection),n.$on("$destroy",function(){a.getCesiumWidget().scene.primitives.remove(n.collection)})}}}}]),angular.module("angularCesium").directive("acGeocoder",function(){"use strict";return{restrict:"E",require:"^acMap",transclude:!0,template:'<div id="geocoderContainer" class="cesium-viewer-geocoderContainer"></div>',controller:["$scope",function(){}],link:{pre:function(e,i,r,o){e.geocoder=null,e.geocoder=new Cesium.Geocoder({container:"geocoderContainer",scene:o.getCesiumWidget().scene}),e.$on("$destroy",function(){o.getCesiumWidget().geocoder.destroy()})}}}}),angular.module("angularCesium").directive("acImageryViewModels",function(){return{restrict:"E",require:"^acBaseLayerPicker",scope:{name:"&",iconUrl:"&",tooltip:"&",creationFunction:"&"},controller:["$scope","Cesium",function(e,i){e.cesiumFactory=i}],link:function(e,i,r,o){var n=new e.cesiumFactory.ProviderViewModel({name:e.name(),iconUrl:e.iconUrl(),tooltip:e.tooltip(),creationFunction:e.creationFunction});o.pushProviderViewModel("imageryProviderViewModels",n),e.$on("$destroy",function(){angular.forEach(o.getImageryViewModels(),function(e,i){e===provider&&o.getImageryViewModels().splice(i,1)})})}}}),angular.module("angularCesium").directive("acLabel",function(){return{restrict:"E",require:"^acLabelsLayer",scope:{color:"&",text:"&",position:"&"},link:function(e,i,r,o){var n={},t=e.position();n.position=Cesium.Cartesian3.fromDegrees(Number(t.longitude)||0,Number(t.latitude)||0,Number(t.altitude)||0);var l=e.color();l&&(n.color=l),n.text=e.text();var a=o.getLabelCollection().add(n);e.$on("$destroy",function(){o.getLabelCollection().remove(a)})}}}),angular.module("angularCesium").directive("acLabelsLayer",function(){return{restrict:"E",require:"^acMap",scope:{},controller:["$scope",function(e){this.getLabelCollection=function(){return e.collection}}],link:{pre:function(e,i,r,o){e.collection=new Cesium.LabelCollection,o.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){o.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),angular.module("angularCesium").directive("acMap",function(){function e(e){return 2==e?Cesium.SceneMode.SCENE2D:2.5==e?Cesium.SceneMode.COLUMBUS_VIEW:Cesium.SceneMode.SCENE3D}function i(e){return"false"==e?!1:!0}return{restrict:"E",template:'<div> <ng-transclude></ng-transclude> <div class="map-container"></div> </div>',transclude:!0,scope:{dimensions:"@",imageryProvider:"@"},controller:["$scope","$element",function(e){this.getCesiumWidget=function(){return e.cesium}}],link:{pre:function(r,o){r.dimensions||(r.dimensions=3),r.cesium=new Cesium.CesiumWidget(o.find("div")[0],{sceneMode:e(r.dimensions),imageryProvider:i(r.imageryProvider)})}}}}),angular.module("angularCesium").directive("acPolyline",function(){return{restrict:"E",require:"^acPolylinesLayer",scope:{color:"&",width:"&",positions:"&"},link:function(e,i,r,o){var n={};if(!angular.isDefined(e.positions)||!angular.isFunction(e.positions))throw"Polyline positions must be defined as a function";var t=e.positions();n.positions=[],angular.forEach(t,function(e){n.positions.push(Cesium.Cartesian3.fromDegrees(Number(e.longitude)||0,Number(e.latitude)||0,Number(e.altitude)||0))});var l=Cesium.Color.fromCssColorString("black");angular.isDefined(e.color)&&angular.isFunction(e.color)&&(l=Cesium.Color.fromCssColorString(e.color())),n.material=Cesium.Material.fromType("Color"),n.material.uniforms.color=l,n.width=1,angular.isDefined(e.width)&&angular.isFunction(e.width)&&(n.width=e.width());var a=o.getPolylineCollection().add(n);e.$on("$destroy",function(){o.getPolylineCollection().remove(a)})}}}),angular.module("angularCesium").directive("acPolylinesLayer",function(){return{restrict:"E",require:"^acMap",scope:{},controller:["$scope",function(e){this.getPolylineCollection=function(){return e.collection}}],link:{pre:function(e,i,r,o){e.collection=new Cesium.PolylineCollection,o.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){o.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),angular.module("angularCesium").directive("acTerrainViewModels",function(){return{restrict:"E",require:"^acBaseLayerPicker",scope:{name:"&",iconUrl:"&",tooltip:"&",creationFunction:"&"},controller:["$scope","Cesium",function(e,i){e.cesiumFactory=i}],link:function(e,i,r,o){var n=new e.cesiumFactory.ProviderViewModel({name:e.name(),iconUrl:e.iconUrl(),tooltip:e.tooltip(),creationFunction:e.creationFunction});o.pushProviderViewModel("terrainProviderViewModels",n),e.$on("$destroy",function(){angular.forEach(o.getTerrainViewModels(),function(e,i){e===provider&&o.getTerrainViewModels().splice(i,1)})})}}}),angular.module("angularCesium").directive("acWebMapServiceLayer",function(){return{restrict:"E",require:"^acMap",scope:{url:"&",layers:"&"},controller:["$scope",function(){}],link:function(e,i,r,o){var n=new Cesium.WebMapServiceImageryProvider({url:e.url(),layers:e.layers()}),t=o.getCesiumWidget().scene.imageryLayers.addImageryProvider(n);e.$on("$destroy",function(){o.getCesiumWidget().scene.imageryLayers.remove(t)})}}});